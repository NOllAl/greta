### Hierarchical linear regression

A hierarchical, Bayesian linear regression model using the iris data, with random intercepts and slopes for each of the three species.
The slopes and intercepts for each species are uncorrelated in this example.

```{r hierarchical_linear_greta}
# linear model parameters
int <- normal(0, 10)
coef <- normal(0, 10)
sd <- cauchy(0, 3, truncation = c(0, Inf))

species_id <- as.numeric(iris$Species)

# random intercepts
species_random_intercept_sd <- lognormal(0, 1)
species_random_intercept_offset <- normal(0, species_random_intercept_sd, dim = 2)
species_random_intercept_effect <- rbind(0, species_random_intercept_offset)

# random slopes
species_random_slope_sd <- lognormal(0, 1)
species_random_slope_offset <- normal(0, species_random_slope_sd, dim = 2)
species_random_slope_effect <- rbind(0, species_random_slope_offset)

# model
mu <- int + coef * iris$Sepal.Width + species_random_intercept_effect[species_id] + iris$Petal.Length * species_random_slope_effect[species_id]
distribution(iris$Sepal.Length) <- normal(mu, sd)
```
